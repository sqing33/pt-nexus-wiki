# Docker

#### 环境变量

| 分类       | 参数             | 说明                                | 示例            |
| :--------- | :--------------- | :---------------------------------- | :-------------- |
| **通用**   | `TZ`             | 设置容器时区，确保时间与日志准确。  | `Asia/Shanghai` |
| **数据库** | `DB_TYPE`        | 选择数据库类型。`sqlite`或`mysql`。 | `sqlite`        |
|            | `MYSQL_HOST`     | **(MySQL 专用)** 数据库主机地址。   | `192.168.1.100` |
|            | `MYSQL_PORT`     | **(MySQL 专用)** 数据库端口。       | `3306`          |
|            | `MYSQL_DATABASE` | **(MySQL 专用)** 数据库名称。       | `pt_nexus`      |
|            | `MYSQL_USER`     | **(MySQL 专用)** 数据库用户名。     | `root`          |
|            | `MYSQL_PASSWORD` | **(MySQL 专用)** 数据库密码。       | `your_password` |

#### Docker Compose 示例

**注：** 目前带转种的版本真正开发与测试中，如果想完整记录下载器的上传量与下载量，推荐试用转种版本的同时安装一个不带转种的版本用于上传量下载量的记录。不带转种的版本镜像为`sqing33/pt-nexus:latest`，带转种的版本为`sqing33/pt-nexus:beta`，镜像同时推送至`DockerHub`与`Github`，无法拉取镜像可尝试更换前缀：`sqing33/pt-nexus`、`ghcr.io/sqing33/pt-nexus`、`ghcr.nju.edu.cn/sqing33/pt-nexus`。

1.  创建一个 `docker-compose.yml` 文件：
    使用 sqlite：

        ```yaml
        services:
          pt-nexus:
            image: ghcr.io/sqing33/pt-nexus
            container_name: pt-nexus
            ports:
              - 5272:15272
            volumes:
              - .:/app/data
            environment:
              - TZ=Asia/Shanghai
              - DB_TYPE=sqlite
        ```

    使用 MySQL：

        ```yaml
        services:
          pt-nexus:
            image: ghcr.io/sqing33/pt-nexus
            container_name: pt-nexus
            ports:
              - 5272:15272
            volumes:
              - .:/app/data
            environment:
              - TZ=Asia/Shanghai
              - DB_TYPE=mysql
              - MYSQL_HOST=192.168.1.100
              - MYSQL_PORT=3306
              - MYSQL_DATABASE=pt_nexus
              - MYSQL_USER=root
              - MYSQL_PASSWORD=your_password
        ```

2.  在与 `docker-compose.yml` 相同的目录下，运行以下命令启动服务：
    ```bash
    docker-compose up -d
    ```
3.  服务启动后，通过 `http://<你的服务器IP>:5272` 访问 PT Nexus 界面。
4.  进入设置页面，添加下载器，如添加后数据未更新则点击右上角`刷新`按钮。

#### 登录

1. 建议设置环境变量 `JWT_SECRET`。
2. 首次登录默认用户名为 `AUTH_USERNAME`（默认 `admin`）。
3. 可二选一设置密码：
   - `AUTH_PASSWORD`：明文密码（便捷但不安全，建议仅测试用）。
   - `AUTH_PASSWORD_HASH`：Bcrypt 哈希，优先于明文。
4. 前端会在本地存储 `token` 并自动注入到后续请求的 `Authorization: Bearer <token>` 头。
5. 退出可清除浏览器本地存储中的 `token`。

# Windows

待开发
