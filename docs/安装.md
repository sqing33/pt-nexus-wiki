# Docker 部署

#### 环境变量

| 分类       | 参数             | 说明                                | 示例            |
| :--------- | :--------------- | :---------------------------------- | :-------------- |
| **通用**   | `TZ`             | 设置容器时区，确保时间与日志准确。  | `Asia/Shanghai` |
| **数据库** | `DB_TYPE`        | 选择数据库类型。`sqlite`或`mysql`。 | `sqlite`        |
|            | `MYSQL_HOST`     | **(MySQL 专用)** 数据库主机地址。   | `192.168.1.100` |
|            | `MYSQL_PORT`     | **(MySQL 专用)** 数据库端口。       | `3306`          |
|            | `MYSQL_DATABASE` | **(MySQL 专用)** 数据库名称。       | `pt_nexus`      |
|            | `MYSQL_USER`     | **(MySQL 专用)** 数据库用户名。     | `root`          |
|            | `MYSQL_PASSWORD` | **(MySQL 专用)** 数据库密码。       | `your_password` |

**注：** `PostgreSQL`数据库将在后续版本进行适配。

#### Docker Compose 示例

**注：** 目前带转种的版本正在开发与测试中，如果想完整记录下载器的上传量与下载量，推荐试用转种版本的同时安装一个不带转种的版本用于上传量下载量的记录。不带转种的版本镜像为`sqing33/pt-nexus:latest`，带转种的版本为`sqing33/pt-nexus:beta`，镜像同时推送至`DockerHub`与`Github`，无法拉取镜像可尝试更换前缀：`sqing33/pt-nexus`、`ghcr.io/sqing33/pt-nexus`、`ghcr.nju.edu.cn/sqing33/pt-nexus`。

1.  创建一个 `docker-compose.yml` 文件

```yaml
# 使用 sqlite
services:
  pt-nexus:
	image: ghcr.io/sqing33/pt-nexus:latest    # ghcr.io/sqing33/pt-nexus:beta
	container_name: pt-nexus
	ports:
	  - 5272:15272
	volumes:
	  - ./data:/app/data
	environment:
	  - TZ=Asia/Shanghai
	  - DB_TYPE=sqlite
```

```yaml
# 使用 MySQL
services:
  pt-nexus:
	image: ghcr.io/sqing33/pt-nexus:latest    # ghcr.io/sqing33/pt-nexus:beta
	container_name: pt-nexus
	ports:
	  - 5272:15272
	volumes:
	  - ./data:/app/data
	environment:
	  - TZ=Asia/Shanghai
	  - DB_TYPE=mysql
	  - MYSQL_HOST=192.168.1.100
	  - MYSQL_PORT=3306
	  - MYSQL_DATABASE=pt_nexus
	  - MYSQL_USER=root
	  - MYSQL_PASSWORD=your_password
```

2.  在与 `docker-compose.yml` 相同的目录下，运行以下命令启动服务：
    ```bash
    docker-compose up -d
    ```
3.  服务启动后，通过 `http://<你的服务器IP>:5272` 访问 PT Nexus 界面。

#### 登录

1. 首次登录默认用户名为 `admin`，随机密码在容器日志查看。
2. 登录成功后请到`设置`-`用户管理`页面修改用户名与密码。
3. 首次登录修改用户名密码后请尝试重启容器查看修改是否生效，目前发现存在映射的`/app/data`目录有权限不对导致无法修改密码的问题，可尝试 ssh 运行`chmod -R 777 path/pt-nexus/data`或者进入容器终端运行`chmod -R 777 /app/data`。

# Windows 部署

待开发
